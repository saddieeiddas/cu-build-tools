{"version":3,"sources":["builder/builder.js"],"names":[],"mappings":"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","file":"builder/builder.js","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport gulpLoadPlugins from 'gulp-load-plugins';\nimport loadConfig from './../util/loadConfig';\nimport createPrefix from './../util/createPrefix';\nimport createSequence from 'run-sequence';\nimport generateVSProj from './../util/generateVSProj';\nimport path from 'path';\nimport gulpUtil from 'gulp-util';\nimport ntypescript from 'ntypescript';\n\nfunction builder(gulp, options) {\n  const plugins = gulpLoadPlugins({\n    'pattern': [\n      'gulp-*',\n      'gulp.*',\n      'browserify',\n      'vinyl-source-stream',\n      'vinyl-buffer',\n      'del',\n      'merge2',\n    ],\n  });\n\n  const config = loadConfig(options);\n  const prefix = createPrefix(config.task_prefix);\n  const sequence = createSequence.use(gulp);\n\n  const plumberOpts = {\n    errorHandler(error) {\n      gulpUtil.log(gulpUtil.colors.red('error:'), error.toString());\n    },\n  };\n\n  gulp.task('default', ['build']);\n\n  gulp.task(prefix('watch-server'), [prefix('watch'), prefix('server')]);\n\n  gulp.task(prefix('server'), () => {\n    plugins.util.log('Starting Server In: ' + config.server.root);\n    plugins.connect.server({\n      'root': config.server.root,\n      'port': config.server.port,\n    });\n  });\n\n  gulp.task(prefix('watch'), [prefix('build')], () =>\n    gulp.watch([config.dir.src + '/**/*'], [prefix('build')])\n  );\n\n  gulp.task(prefix('build'), (cb) => sequence(\n    prefix('clean'),\n    prefix('lint'),\n    prefix('compile'),\n    [\n      'vsgen',\n      prefix('bundle'),\n      prefix('stylus'),\n      prefix('definitions'),\n      prefix('copy'),\n    ],\n    prefix('clean:tmp'),\n    cb\n  ));\n\n  gulp.task(prefix('clean'), [prefix('clean:dist'), prefix('clean:tmp'), prefix('clean:lib')]);\n\n  gulp.task(prefix('clean:dist'), (cb) => plugins.del([\n    config.dir.dist + '/**/*',\n    config.dir.dist,\n  ], {'force': true}, cb));\n\n  gulp.task(prefix('clean:tmp'), (cb) => plugins.del([\n    config.dir.tmp + '/**/*',\n    config.dir.tmp,\n  ], {'force': true}, cb));\n\n  gulp.task(prefix('clean:lib'), (cb) => plugins.del([\n    config.dir.lib + '/**/*',\n    config.dir.lib,\n  ], {'force': true}, cb));\n\n  gulp.task(prefix('lint'), (cb) => {\n    if (config.engine === 'js') {\n      return gulp.src(config.glob.js)\n        .pipe(plugins.eslint())\n        .pipe(plugins.eslint.format());\n    }\n    cb();\n  });\n\n  gulp.task(prefix('stylus'), () =>\n    gulp.src(config.glob.stylus)\n      .pipe(plugins.plumber(plumberOpts))\n      .pipe(plugins.sourcemaps.init())\n      .pipe(plugins.stylus())\n      .pipe(plugins.sourcemaps.write('.'))\n      .pipe(gulp.dest(config.dir.dist + '/css'))\n  );\n\n  gulp.task(prefix('compile'), () => {\n    if (config.engine === 'js') {\n      return gulp.src(config.glob.js)\n        .pipe(plugins.plumber(plumberOpts))\n        .pipe(plugins.sourcemaps.init({'loadMaps': true}))\n        .pipe(plugins.babel())\n        .pipe(plugins.sourcemaps.write({'sourceRoot': '../', 'includeContent': true}))\n        .pipe(gulp.dest(config.dir.lib));\n    }\n\n    const result = gulp.src(config.glob.ts)\n      .pipe(plugins.plumber(plumberOpts))\n      .pipe(plugins.sourcemaps.init({'loadMaps': true}))\n      .pipe(plugins.typescript({\n        'declarationFiles': true,\n        'noExternalResolve': false,\n        'module': 'commonjs',\n        'jsx': 'react',\n        'typescript': ntypescript,\n      }));\n\n    return plugins.merge2([\n      result.js.pipe(plugins.sourcemaps.write({'sourceRoot': '../', 'includeContent': true})).pipe(gulp.dest(config.dir.tmp)),\n    ]);\n  });\n\n  gulp.task('vsgen', (cb) => {\n    if (config.build.vsgen) {\n      let all = [];\n      for (const p in config.glob) {\n        if (config.glob.hasOwnProperty(p)) {\n          all = all.concat(config.glob[p]);\n        }\n      }\n\n      let proj = config.proj_name || config.name;\n      const ext = path.extname(proj);\n      if (!ext || ext === '') {\n        proj += '.csproj';\n      }\n      proj = path.join(config.path, proj);\n\n      return gulp.src(all, {'base': config.path})\n        .pipe(generateVSProj(proj))\n        .pipe(plugins.plumber(plumberOpts));\n    }\n    cb();\n  });\n\n  function bundle(shouldMinify, cb) {\n    let entry = config.main_name + '.js';\n    if (config.engine === 'js') {\n      entry = config.dir.lib + '/' + config.bundle_name.replace('.jsx', '.js');\n    } else {\n      entry = config.dir.tmp + '/' + config.main_name + '.js';\n    }\n\n    const b = plugins.browserify({\n      'entries': entry,\n      'debug': true,\n    });\n\n    return b.bundle()\n      .on('error', (err) => {\n        plugins.util.log(plugins.util.colors.red(err.message));\n        cb();\n      })\n      .pipe(plugins.vinylSourceStream(config.name + (shouldMinify ? '.min' : '') + '.js'))\n      .pipe(plugins.vinylBuffer())\n      .pipe(plugins.sourcemaps.init({'loadMaps': true}))\n      .pipe(plugins.if(shouldMinify, plugins.uglify()))\n      .pipe(plugins.if(shouldMinify, plugins.header(config.license)))\n      .pipe(plugins.sourcemaps.write('.', {'sourceRoot': '../../', 'includeContent': true}))\n      .pipe(gulp.dest(config.dir.dist + '/js'));\n  }\n\n  gulp.task(prefix('bundle'), [prefix('bundle:prod'), prefix('bundle:dev')]);\n\n  gulp.task(prefix('bundle:prod'), (cb) => {\n    if (config.build.compress) {\n      return bundle(true, cb);\n    }\n    cb();\n  });\n\n  gulp.task(prefix('bundle:dev'), (cb) =>\n    bundle(false, cb)\n  );\n\n  gulp.task(prefix('definitions'), (cb) => {\n    if (config.engine === 'js') {\n      return gulp.src(config.dir.definitions + '/**/*.d.ts')\n        .pipe(plugins.plumber(plumberOpts))\n        .pipe(gulp.dest(config.dir.lib));\n    }\n    cb();\n  });\n\n  gulp.task(prefix('copy'), [prefix('copy:ui'), prefix('copy:assets')]);\n\n  gulp.task(prefix('copy:ui'), () => {\n    const target = config.build_type === 'publish'\n      ? config.dir.publish\n      : config.dir.dist;\n    return gulp.src([\n      config.dir.src + '/*.ui',\n    ], {'base': config.dir.src}).pipe(gulp.dest(target));\n  });\n\n  gulp.task(prefix('copy:assets'), () =>\n    gulp.src([\n      config.dir.src + '/images/**/*',\n      config.dir.src + '/audio/**/*',\n      config.dir.src + '/**/*.html',\n    ], {'base': config.dir.src}).pipe(gulp.dest(config.dir.dist))\n  );\n}\n\nexport default builder;\n"],"sourceRoot":"/source/"}