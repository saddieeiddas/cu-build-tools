{"version":3,"sources":["builder/multi.js"],"names":[],"mappings":"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","file":"builder/multi.js","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport loadPlugins from 'gulp-load-plugins';\nimport loadConfig from './../util/loadConfig';\nimport debug from 'gulp-debug';\nimport install from 'gulp-install';\nimport minimist from 'minimist';\nimport legacy from './../util/legacy';\nimport createSequence from 'run-sequence';\nimport subTaskUtil from './../util/subTaskUtil';\n\nfunction multi(gulp, options) {\n  const plugins = loadPlugins({\n    'pattern': [\n      'gulp-*',\n      'gulp.*',\n      'browserify',\n      'vinyl-source-stream',\n      'vinyl-buffer',\n      'del',\n      'merge2',\n    ],\n  });\n\n  const config = loadConfig(options);\n  const sequence = createSequence.use(gulp);\n  const argv = minimist(process.argv.slice(2));\n  const subTask = subTaskUtil.resolveTask(config.path);\n  const subArgs = {\n    'publish': argv.publish && typeof argv.publish === 'boolean' ? config.dir.publish : null,\n  };\n\n  if (subTask) {\n    gulp.task(subTask.gulpTask, cb => subTaskUtil.executeTask(gulp, {\n      'path': config.path,\n      'component': subTask.component,\n      'task': subTask.task,\n      'args': subArgs,\n    }, cb));\n  }\n\n  gulp.task('install', (cb) => {\n    const directories = subTaskUtil.findComponentDirectories(config.path);\n    if (directories.length === 0) {\n      cb();\n    } else {\n      const packages = directories.map((component) => component + '/package.json');\n      return gulp.src(packages)\n        .pipe(debug({'title': 'installing:'}))\n        .pipe(install({'production': true}));\n    }\n  });\n\n  gulp.task('build', (cb) => sequence(\n    'clean',\n    'compile:legacy',\n    'copy:legacy',\n    'compile',\n    cb\n  ));\n\n  gulp.task('compile', (cb) => subTaskUtil.executeTaskOnAllComponents(gulp, {\n    'path': config.path,\n    'task': 'build',\n    'args': {'publish': config.dir.publish},\n  }, cb));\n\n  gulp.task('clean', (cb) => plugins.del([\n    config.dir.publish + '/**/*',\n    config.dir.publish,\n  ], cb));\n\n  gulp.task('compile:legacy', (cb) => {\n    if (config.legacy) {\n      const directories = legacy.getDirectories(config).map((directory) => directory + '**/*.ts');\n      if (directories.length === 0) {\n        cb();\n      } else {\n        return gulp.src(directories, {'base': config.path})\n          .on('error', plugins.util.log)\n          .pipe(plugins.sourcemaps.init({'loadMaps': true}))\n          .pipe(plugins.typescript({\n            'declarationFiles': true,\n            'noExternalResolve': false,\n            'module': 'commonjs',\n            'jsx': 'react',\n            'typescript': require('ntypescript'),\n          }))\n          .js\n          .pipe(plugins.sourcemaps.write({'sourceRoot': '../', 'includeContent': true}))\n          .pipe(gulp.dest(config.dir.publish));\n      }\n    } else {\n      cb();\n    }\n  });\n\n  gulp.task('copy:legacy', ['copy:legacy:files', 'copy:legacy:ui']);\n\n  gulp.task('copy:legacy:files', (cb) => {\n    if (config.legacy) {\n      const directories = legacy.getDirectories(config);\n      const globs = [];\n      directories.forEach((directory) => {\n        globs.push(directory + '**/*');\n        globs.push('!' + directory + '**/*.ts');\n        globs.push('!' + directory + '**/*.ui');\n      });\n\n      if (directories.length === 0) {\n        cb();\n      } else {\n        return gulp.src(globs, {'base': config.path}).pipe(gulp.dest(config.dir.publish));\n      }\n    } else {\n      cb();\n    }\n  });\n\n  gulp.task('copy:legacy:ui', (cb) => {\n    if (config.legacy) {\n      const directories = legacy.getDirectories(config);\n      const globs = [];\n      directories.forEach((directory) => {\n        globs.push(directory + '**/*.ui');\n      });\n\n      if (directories.length === 0) {\n        cb();\n      } else {\n        return gulp.src(globs).pipe(gulp.dest(config.dir.publish));\n      }\n    } else {\n      cb();\n    }\n  });\n}\n\nexport default multi;\n"],"sourceRoot":"/source/"}