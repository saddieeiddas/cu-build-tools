{"version":3,"sources":["builder/multi.js"],"names":[],"mappings":"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","file":"builder/multi.js","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport loadPlugins from 'gulp-load-plugins';\r\nimport loadConfig from './../util/loadConfig';\r\nimport debug from 'gulp-debug';\r\nimport install from 'gulp-install';\r\nimport minimist from 'minimist';\r\nimport legacy from './../util/legacy';\r\nimport createSequence from 'run-sequence';\r\nimport subTaskUtil from './../util/subTaskUtil';\r\n\r\nfunction multi(gulp, options) {\r\n  const plugins = loadPlugins({\r\n    'pattern': [\r\n      'gulp-*',\r\n      'gulp.*',\r\n      'browserify',\r\n      'vinyl-source-stream',\r\n      'vinyl-buffer',\r\n      'del',\r\n      'merge2',\r\n    ],\r\n  });\r\n\r\n  const config = loadConfig(options);\r\n  const sequence = createSequence.use(gulp);\r\n  const argv = minimist(process.argv.slice(2));\r\n  const subTask = subTaskUtil.resolveTask(config.path);\r\n  const subArgs = {\r\n    'publish': argv.publish && typeof argv.publish === 'boolean' ? config.dir.publish : null,\r\n  };\r\n\r\n  if (subTask) {\r\n    gulp.task(subTask.gulpTask, cb => subTaskUtil.executeTask(gulp, {\r\n      'path': config.path,\r\n      'component': subTask.component,\r\n      'task': subTask.task,\r\n      'args': subArgs,\r\n    }, cb));\r\n  }\r\n\r\n  gulp.task('install', (cb) => {\r\n    const directories = subTaskUtil.findComponentDirectories(config.path);\r\n    if (directories.length === 0) {\r\n      cb();\r\n    } else {\r\n      const packages = directories.map((component) => component + '/package.json');\r\n      return gulp.src(packages)\r\n        .pipe(debug({'title': 'installing:'}))\r\n        .pipe(install({'production': true}));\r\n    }\r\n  });\r\n\r\n  gulp.task('build', (cb) => sequence(\r\n    'clean',\r\n    'compile:legacy',\r\n    'copy:legacy',\r\n    'compile',\r\n    cb\r\n  ));\r\n\r\n  gulp.task('compile', (cb) => subTaskUtil.executeTaskOnAllComponents(gulp, {\r\n    'path': config.path,\r\n    'task': 'build',\r\n    'args': {'publish': config.dir.publish},\r\n  }, cb));\r\n\r\n  gulp.task('clean', (cb) => plugins.del([\r\n    config.dir.publish + '/**/*',\r\n    config.dir.publish,\r\n  ], cb));\r\n\r\n  gulp.task('compile:legacy', (cb) => {\r\n    if (config.legacy) {\r\n      const directories = legacy.getDirectories(config).map((directory) => directory + '**/*.ts');\r\n      if (directories.length === 0) {\r\n        cb();\r\n      } else {\r\n        return gulp.src(directories, {'base': config.path})\r\n          .on('error', plugins.util.log)\r\n          .pipe(plugins.sourcemaps.init({'loadMaps': true}))\r\n          .pipe(plugins.typescript({\r\n            'declarationFiles': true,\r\n            'noExternalResolve': false,\r\n            'module': 'commonjs',\r\n            'jsx': 'react',\r\n            'typescript': require('ntypescript'),\r\n          }))\r\n          .js\r\n          .pipe(plugins.sourcemaps.write({'sourceRoot': '../', 'includeContent': true}))\r\n          .pipe(gulp.dest(config.dir.publish));\r\n      }\r\n    } else {\r\n      cb();\r\n    }\r\n  });\r\n\r\n  gulp.task('copy:legacy', ['copy:legacy:files', 'copy:legacy:ui']);\r\n\r\n  gulp.task('copy:legacy:files', (cb) => {\r\n    if (config.legacy) {\r\n      const directories = legacy.getDirectories(config);\r\n      const globs = [];\r\n      directories.forEach((directory) => {\r\n        globs.push(directory + '**/*');\r\n        globs.push('!' + directory + '**/*.ts');\r\n        globs.push('!' + directory + '**/*.ui');\r\n      });\r\n\r\n      if (directories.length === 0) {\r\n        cb();\r\n      } else {\r\n        return gulp.src(globs, {'base': config.path}).pipe(gulp.dest(config.dir.publish));\r\n      }\r\n    } else {\r\n      cb();\r\n    }\r\n  });\r\n\r\n  gulp.task('copy:legacy:ui', (cb) => {\r\n    if (config.legacy) {\r\n      const directories = legacy.getDirectories(config);\r\n      const globs = [];\r\n      directories.forEach((directory) => {\r\n        globs.push(directory + '**/*.ui');\r\n      });\r\n\r\n      if (directories.length === 0) {\r\n        cb();\r\n      } else {\r\n        return gulp.src(globs).pipe(gulp.dest(config.dir.publish));\r\n      }\r\n    } else {\r\n      cb();\r\n    }\r\n  });\r\n}\r\n\r\nexport default multi;\r\n"],"sourceRoot":"/source/"}