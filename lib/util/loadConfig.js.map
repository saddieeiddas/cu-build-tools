{"version":3,"sources":["util/loadConfig.js"],"names":[],"mappings":"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","file":"util/loadConfig.js","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport path from 'path';\nimport fs from 'fs';\nimport extend from 'extend';\nimport minimist from 'minimist';\n\nfunction loadConfig(custom) {\n  const argv = minimist(process.argv.slice(2));\n\n  const config = {\n    'engine': null,\n    'type': 'library',\n    'task_prefix': '',\n    'path': './',\n    'glob': {\n      'js': ['src/js/**/*.js', 'src/js/**/*.jsx'],\n      'ts': ['src/ts/**/*.ts', 'src/ts/**/*.tsx'],\n      'stylus': ['src/style/**/*.styl'],\n    },\n    'dir': {\n      'src': 'src',\n      'dist': 'dist',\n      'tmp': 'tmp',\n      'lib': 'lib',\n      'definitions': 'src/definitions',\n      'publish': 'publish',\n      'ui': null,\n    },\n    'publish': {\n      'target': null,\n      'target_path': null,\n    },\n    'main_name': 'main',\n    'bundle_name': null,\n    'proj_name': null,\n    'name': null,\n    'file': {\n      'main': null,\n      'definition': null,\n      'bundle': null,\n    },\n    'server': {\n      'root': null,\n      'port': 9000,\n    },\n    'build': {\n      'compress': null,\n      'vsgen': true,\n    },\n    'legacy': null,\n    'exclude': [],\n    'build_type': 'build',\n    'license': [\n      '/* This Source Code Form is subject to the terms of the Mozilla Public',\n      ' * License, v. 2.0. If a copy of the MPL was not distributed with this',\n      ' * file, You can obtain one at http://mozilla.org/MPL/2.0/. */',\n      '',\n    ].join('\\n'),\n  };\n\n  function resolve(paths, directory = config.path) {\n    if (Array.isArray(paths)) {\n      return paths.map((p) => path.resolve(directory + '/' + p));\n    }\n    return path.resolve(directory + '/' + paths);\n  }\n\n  if (!custom.processed) {\n    extend(true, config, custom);\n\n    config.path = path.resolve(config.path);\n\n    config.glob.js = resolve(config.glob.js);\n    config.glob.ts = resolve(config.glob.ts);\n    config.glob.stylus = resolve(config.glob.stylus);\n\n    config.dir.src = resolve(config.dir.src);\n    config.dir.dist = resolve(config.dir.dist);\n    config.dir.tmp = resolve(config.dir.tmp);\n    config.dir.lib = resolve(config.dir.lib);\n    config.dir.definitions = resolve(config.dir.definitions);\n    if (config.build_type === 'build') {\n      config.dir.publish = resolve(config.dir.publish);\n    }\n\n    if (config.publish.target === null) {\n      config.publish.target = config.name;\n    }\n\n    if (argv.publish && typeof argv.publish === 'string') {\n      config.dir.publish = path.resolve(argv.publish);\n    } else if (argv.publish && typeof argv.publish === 'boolean' && (!custom.dir || !custom.dir.publish)) {\n      if (fs.existsSync(path.resolve(config.path + '/../cu-build.config.js'))) {\n        const parentConfig = require(path.resolve(config.path + '/../cu-build.config.js'));\n        if (parentConfig.dir && parentConfig.dir.publish) {\n          config.dir.publish = path.resolve(parentConfig.path + '/' + parentConfig.dir.publish);\n        }\n      }\n    }\n\n    if (config.dir.ui === null) {\n      config.dir.ui = config.dir.publish;\n    } else {\n      config.dir.ui = resolve(config.dir.ui);\n    }\n\n    config.publish.target_path = path.resolve(config.dir.publish + '/' + config.publish.target);\n\n    if (config.build_type === 'publish' || argv.publish) {\n      config.dir.dist = config.publish.target_path;\n      config.server.root = config.publish.target_path;\n    }\n\n    if (config.engine === null) {\n      if (config.type === 'component') {\n        config.engine = 'ts';\n      } else {\n        config.engine = 'js';\n      }\n    }\n\n    if (config.name === null) {\n      config.name = config.type;\n    }\n\n\n    if (config.file.main === null) {\n      config.file.main = resolve('/' + config.engine + '/' + config.main_name + '.' + config.engine, config.dir.src);\n    } else {\n      config.file.main = resolve(config.file.main);\n    }\n\n    if (config.file.definition === null) {\n      config.file.definition = resolve('/' + config.main_name + '.d.ts', config.dir.definitions);\n    } else {\n      config.file.definition = resolve(config.file.definition);\n    }\n\n    if (config.file.bundle === null) {\n      if (config.type === 'library') {\n        config.file.bundle = resolve('/' + config.engine + '/' + config.main_name + '-bundle.' + config.engine, config.dir.src);\n      } else {\n        config.file.bundle = resolve('/' + config.engine + '/' + config.main_name + '.' + config.engine, config.dir.src);\n      }\n    } else {\n      config.file.bundle = resolve(config.file.bundle);\n    }\n\n    config.bundle_name = path.basename(config.file.bundle);\n\n    if (fs.existsSync(config.file.main) === false) {\n      if (config.engine === 'js') {\n        config.file.main = config.file.main.replace('.js', '.jsx');\n      } else {\n        config.file.main = config.file.main.replace('.ts', '.tsx');\n      }\n    }\n\n    if (config.server.root === null) {\n      if (config.type === 'library') {\n        config.server.root = './';\n      } else {\n        config.server.root = 'dist';\n      }\n    }\n\n    if (config.type === 'library') {\n      config.build.compress = true;\n    }\n\n    config.exclude = resolve(config.exclude);\n\n    config.exclude = config.exclude.map((exclude) => '!' + exclude);\n\n    if (argv.port) {\n      config.server.port = argv.port;\n    }\n\n    if (argv.publish) {\n      config.build_type = 'publish';\n    }\n\n    if (argv.vsgen === 'false') {\n      config.build.vsgen = false;\n    }\n\n    config.processed = true;\n\n    return config;\n  }\n  return custom;\n}\n\nexport default loadConfig;\n"],"sourceRoot":"/source/"}