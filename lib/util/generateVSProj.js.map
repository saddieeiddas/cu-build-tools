{"version":3,"sources":["util/generateVSProj.js"],"names":[],"mappings":"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","file":"util/generateVSProj.js","sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport through from 'through2';\nimport path from 'path';\nimport fs from 'fs';\nimport gulpUtil from 'gulp-util';\nimport extend from 'extend';\nimport xmldom from 'xmldom';\n\nfunction generateVSProj(proj, opt = {}) {\n  const PluginError = gulpUtil.PluginError;\n  const DOMParser = xmldom.DOMParser;\n  const XMLSerializer = xmldom.XMLSerializer;\n  const files = [];\n\n  if (!proj) {\n    throw new PluginError('vsgen', 'Missing proj parameter for vsgen');\n  }\n\n  const config = {\n    'tags': {\n      '.ts': 'TypeScriptCompile',\n      '.tsx': 'TypeScriptCompile',\n      '..': 'Content',\n    },\n    'template': path.join(__dirname, '..', 'content', 'template.proj'),\n  };\n  extend(true, config, opt);\n\n  function bufferContent(file, enc, cb) {\n    if (!file.isNull()) {\n      files.push(file.relative);\n    }\n    cb();\n  }\n\n  function endStream(cb) {\n    const that = this;\n    fs.readFile(config.template, 'utf8', (err, content) => {\n      if (err) {\n        that.emit('error', err);\n        cb();\n        return;\n      }\n\n      try {\n        const dom = new DOMParser().parseFromString(content);\n        const target = dom.getElementById('vsgen-target');\n\n        if (!target) {\n          throw new PluginError('vsgen', 'Could not find vsgen-target element');\n        }\n        target.removeAttribute('id'); // VS or MSBuild might not like this.\n\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i];\n          const ext = path.extname(file);\n          const tagName = config.tags.hasOwnProperty(ext)\n            ? config.tags[ext]\n            : config.tags['..'];\n\n          const element = dom.createElementNS(target.namespaceURI, tagName);\n          element.setAttribute('Include', file);\n          target.appendChild(element);\n        }\n\n        const finalContent = new XMLSerializer().serializeToString(dom);\n        fs.writeFile(proj, finalContent, 'utf8', (writeError) => {\n          if (writeError) {\n            that.emit('error', writeError);\n          }\n          cb();\n        });\n      } catch (e) {\n        that.emit('error', e);\n        cb();\n      }\n    });\n  }\n\n  return through.obj(bufferContent, endStream);\n}\n\nexport default generateVSProj;\n"],"sourceRoot":"/source/"}